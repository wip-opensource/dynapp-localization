var z=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports);var D=z((W,F)=>{var E=require("fs"),b=require("path"),w=require("vscode");function j(t,o){A(t,o)}async function A(t,o){let c=P()[0],p=w.workspace.getConfiguration("dynapp-localization").get("prefillvalue")||"",s=await w.window.showInputBox({value:p,title:`Value: ${t}`,prompt:"Enter the key name for the new message in "+b.basename(c)});if(s){let r=`
`+s+"="+t;try{await E.promises.appendFile(c,r);let n=w.window.activeTextEditor;n&&await n.edit(h=>{h.replace(o,`%{${s}}`)}),w.window.showInformationMessage(`New entry "${t}" added to `+b.basename(c))}catch{w.window.showErrorMessage("Failed to add new entry to messages.properties")}}}function M(){let t=I(),o=JSON.parse(require("fs").readFileSync(b.join(k(),t,"root.json"),"utf8"));return o?o.localizationprefixes||[]:null}function I(){return w.workspace.getConfiguration("dynapp-localization").get("dataitempath")||""}function k(t=w.window.activeTextEditor){if(!t)return null;let o=t.document,c=w.workspace.getWorkspaceFolder(o.uri);return c?c.uri.fsPath:null}function R(t,o=/%\{([^\}]+)\}/g){let p=[...t.getText().matchAll(o)],s=[];for(let r of p){let n=t.positionAt(r.index),h=t.positionAt(r.index+r[0].length),i=new w.Range(n,h);s.push({text:r[0],range:i})}return s}function $(t){var o=null,c="None",p=P();return p.every(s=>(o=C(t,s),o?(c=s,console.log(`key: ${t}, found in ${b.basename(s)}`),!1):!0)),o||(w.workspace.getConfiguration("dynapp-localization").get("languagePostfixes")||[]).every(s=>{var r=P(s);return r.every(n=>(o=C(t,n),o?(c=n,console.log(`key: ${t}, found in ${b.basename(n)}`),!1):!0)),!o}),{value:o,file:c}}function C(t,o){if(!E.existsSync(o))return null;let c=t.match(/%\{(.+)\}/);if(c){let p=c[1],s=o,n=E.readFileSync(s,"utf8").match(new RegExp(`^${p}=(.+)`,"m"));return n?n[1]:null}}function P(t=w.workspace.getConfiguration("dynapp-localization").get("defaultlanguage")||""){let o=w.window.activeTextEditor;if(!o)return null;let c=w.workspace.getConfiguration("dynapp-localization").get("dataitempath")||"",p=M();p.unshift("");var s=[];return p.forEach(r=>{var n=`${r}-`;r==""&&(n=""),t!==""?n+=`messages_${t}.properties`:n+="messages.properties";let h=b.join(k(o)+c,n);E.existsSync(h)&&s.push(h)}),s}function S(t){let o=[];try{JSON.parse(t.getText())}catch{return[]}function c(i,a,l){let e=t.positionAt(a.indexOf(i)),u=t.positionAt(a.indexOf(i)+i.length),v=new w.Range(e,u);l.push(v)}function p(i,a,l){if(i){if(i.endsWith(".json")||i.endsWith(".png")||i.endsWith(".jpg")||i.endsWith(".jpeg"))return;/%\{([^\}]+)\}/.test(i)||c(i,a,l)}}function s(i,a,l){for(let e of i)e.text&&p(e.text,a,l),e.subviews&&s(e.subviews,a,l)}let r=t.getText(),n=JSON.parse(t.getText());if(n.bindings||n.itembindings){let i=n.bindings||n.itembindings,a=null,l=[];i.forEach(e=>{e.view&&(e.view.includes(":background")||e.view.includes(":color")||e.view.includes(":hintcolor")||e.view.includes(":bordercolor")||e.view.includes(":actioncolor")||e.view.includes(":tint"))||e.source&&(typeof e.source=="string"||e.source instanceof String?a=e.source:(typeof e.source=="object"||e.source instanceof Object)&&e.source.type&&e.source.type=="literal"&&e.source.value&&(a=e.source.value),a&&(l.includes(a)||l.push(a)))}),n.waitmessage&&l.push(n.waitmessage),l.forEach(e=>{p(e,r,o)})}else if(typeof n=="object"||n instanceof Object)n.subviews&&s(n.subviews,r,o);else{var h=[];Array.isArray(n)?h=n:n.items&&Array.isArray(n.items)&&(h=n.items);let i=["title","subtitle","text","body"];h.forEach(a=>{let l=[];i.forEach(e=>{a[e]&&(typeof a[e]=="string"||a[e]instanceof String?l.push(a[e]):(typeof a[e]=="object"||a[e]instanceof Object)&&a[e].type&&a[e].type=="literal"&&a[e].value&&l.push(a[e].value))}),l.forEach(e=>{p(e,r,o)})})}return o}F.exports={StartPlaceInMessage:j,getMatchingStrings:R,getValueFromMessages:$,getLocalizationPrefixes:M,getMessagesPaths:P,getUnderlineRanges:S,PlaceInMessagesAsync:A}});var d=require("vscode"),x=D(),U=require("fs"),V=require("path");function q(t){let o=d.commands.registerCommand("dynapp-localization.testCommand",(u,v)=>{console.log(x.getMessagesPaths())});t.subscriptions.push(o),console.log('Congratulations, your extension "dynapp-localization" is now active!');let c=d.commands.registerCommand("dynapp-localization.placeInMessage",(u,v)=>{let g=d.window.activeTextEditor,f=g.selection;if(f&&!f.isEmpty){let y=new d.Range(f.start.line,f.start.character,f.end.line,f.end.character),m=g.document.getText(y);m&&x.StartPlaceInMessage(m,y)}});t.subscriptions.push(c);let p=d.commands.registerCommand("dynapp-localization.placeRangeInMessage",(u,v)=>{if(v){let g=d.window.activeTextEditor.document.getText(v);g&&x.StartPlaceInMessage(g,v)}});t.subscriptions.push(p),t.subscriptions.push(d.languages.registerHoverProvider({scheme:"file"},{provideHover(u,v,g){let f=u.getWordRangeAtPosition(v,/%\{([^\}]+)\}/);if(f){let y=u.getText(f),m=x.getValueFromMessages(y);if(m)return new d.Hover(` ${V.basename(m.file)}: ${m.value}`)}}}));let s=d.window.activeTextEditor,r=[],n=[];function h(){if(!s)return;r.forEach(f=>{s.setDecorations(f,[])}),r=[];let u=s.document;x.getMatchingStrings(u).forEach(f=>{var y=x.getValueFromMessages(f.text).value||"No value found";let m=d.window.createTextEditorDecorationType({after:{contentText:"."+y,color:d.workspace.getConfiguration("dynapp-localization").get("annotationcolor")||"rgba(110, 110, 110, 0.8"}});r.push(m);let T=[f.range];s.setDecorations(m,T)}),n=x.getUnderlineRanges(u);let g=d.window.createTextEditorDecorationType({textDecoration:"underline yellow dotted"});n.forEach(f=>{r.push(g)}),s.setDecorations(g,n)}let i=d.commands.registerCommand("dynapp-localization.placeAllStringsInMessages",async function(u,v){let g=d.window.activeTextEditor;if(g){let f=g.document;if(f){let y=x.getUnderlineRanges(f);for(let m of y){let T=g.document.getText(m);await x.PlaceInMessagesAsync(T,m)}}}});t.subscriptions.push(i);class a{provideCodeActions(v,g,f,y){let m=new d.CodeAction("Place in messages",d.CodeActionKind.QuickFix);for(let T of n)if(T.contains(g.start))return m.command={title:"Place in messages",command:"dynapp-localization.placeRangeInMessage",arguments:[v,T]},[m];return[]}}d.languages.registerCodeActionsProvider({scheme:"file"},new a);let l;function e(u=!1){l&&(clearTimeout(l),l=void 0),u?l=setTimeout(h,500):h()}s&&e(),d.window.onDidChangeActiveTextEditor(u=>{s=u,u&&e()},null,t.subscriptions),d.workspace.onDidChangeTextDocument(u=>{s&&u.document===s.document&&e(!0)},null,t.subscriptions)}function O(){}module.exports={activate:q,deactivate:O};
